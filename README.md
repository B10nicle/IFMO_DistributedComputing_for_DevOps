## üì¶ Distributed Computing Project: Ansible + Docker + PostgreSQL + Strapi

–ü—Ä–æ–µ–∫—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ CMS Strapi –∏ PostgreSQL-–∫–ª–∞—Å—Ç–µ—Ä–∞ (–º–∞—Å—Ç–µ—Ä + —Å–ª–µ–π–≤) —Å –ø–æ–º–æ—â—å—é **Ansible**, **Docker** –∏ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ `.env`.

---

### üìå –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- Ansible 2.15+
- –ö–æ–ª–ª–µ–∫—Ü–∏—è `community.docker`
- Docker —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ —Ü–µ–ª–µ–≤–æ–π –º–∞—à–∏–Ω–µ

---

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
IFMO_DistributedComputing_for_DevOps/
‚îú‚îÄ‚îÄ .env                  # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ .env.example          # –®–∞–±–ª–æ–Ω .env
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ ansible.cfg
‚îú‚îÄ‚îÄ inventory.yml         # –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∏–∑ .env
‚îú‚îÄ‚îÄ Makefile              # –ê–ª–∏–∞—Å—ã (hw1, hw2, check, clean)
‚îú‚îÄ‚îÄ README.md

‚îú‚îÄ‚îÄ group_vars/
‚îÇ   ‚îî‚îÄ‚îÄ all.yml           # –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ Ansible (—á–∏—Ç–∞—é—Ç .env)

‚îú‚îÄ‚îÄ playbooks/
‚îÇ   ‚îú‚îÄ‚îÄ check_cluster.yml # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ (—á—Ç–µ–Ω–∏–µ + write-—Ñ–µ–π–ª)
‚îÇ   ‚îú‚îÄ‚îÄ cleanup.yml       # –û—á–∏—Å—Ç–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤, volume, —Å–µ—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ hw1.yml           # –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ Strapi –∏ master PostgreSQL
‚îÇ   ‚îî‚îÄ‚îÄ hw2.yml           # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–ø–ª–∏–∫–∏ –∫ master

‚îú‚îÄ‚îÄ roles/
‚îÇ   ‚îú‚îÄ‚îÄ pg_cluster_master/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tasks/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ main.yml  # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PostgreSQL master
‚îÇ   ‚îú‚îÄ‚îÄ pg_cluster_replica/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tasks/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ main.yml  # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PostgreSQL replica
‚îÇ   ‚îî‚îÄ‚îÄ strapi/
‚îÇ       ‚îî‚îÄ‚îÄ tasks/
‚îÇ           ‚îî‚îÄ‚îÄ main.yml  # –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ CMS Strapi
```

---

### ‚öôÔ∏è –ü—Ä–∏–º–µ—Ä .env

```env
# SSH
VM1_HOST_IP=
VM1_SSH_USER=
VM1_SSH_KEY_PATH=

# PostgreSQL / Strapi
PG_REPLICATION_USER=
PG_REPLICATION_PASSWORD=
PG_USERNAME=
PG_PASSWORD=
PG_DATABASE=
PG_POSTGRES_PASSWORD=

# –°—Ç–∞—Ç—É—Å-–ø—Ä–æ–≤–µ—Ä–∫–∞ Strapi
STRAPI_CHECK_DELAY=
STRAPI_CHECK_RETRIES=
```

> –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `group_vars/all.yml` –¥–ª—è –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–Ω–∞—á–µ–Ω–∏–π –∏–∑ `.env`.

---

### üöÄ –ö–æ–º–∞–Ω–¥—ã Makefile

| –ö–æ–º–∞–Ω–¥–∞         | –î–µ–π—Å—Ç–≤–∏–µ                                                   |
|------------------|------------------------------------------------------------|
| `make init`      | –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ `.env`                  |
| `make install-deps` | –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç Docker-–∫–æ–ª–ª–µ–∫—Ü–∏—é Ansible                |
| `make hw1`       | –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç Strapi –∏ PostgreSQL master (`hw1.yml`)     |
| `make hw2`       | –î–æ–±–∞–≤–ª—è–µ—Ç PostgreSQL —Ä–µ–ø–ª–∏–∫—É (`hw2.yml`)                 |
| `make check`     | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é –∏ read-only —Å—Ç–∞—Ç—É—Å (`check_cluster.yml`) |
| `make clean`     | –£–¥–∞–ª—è–µ—Ç –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, volumes –∏ —Å–µ—Ç–∏ (`cleanup.yml`)    |
| `make ping`      | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç SSH-–¥–æ—Å—Ç—É–ø –∫ —Ö–æ—Å—Ç—É                              |

---

### ‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

- üìÜ –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ PostgreSQL master —á–µ—Ä–µ–∑ Bitnami-–æ–±—Ä–∞–∑
- üîÅ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ PostgreSQL replica —Å WAL-—Ä–µ–ø–ª–∏–∫–∞—Ü–∏–µ–π
- üåê Strapi CMS –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –º–∞—Å—Ç–µ—Ä—É —á–µ—Ä–µ–∑ Docker-—Å–µ—Ç—å
- üîê –í—Å–µ –ø–∞—Ä–æ–ª–∏ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Äî –≤ `.env`, –Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–ª–µ–π–±—É–∫–∞—Ö
- üß† –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ `check_cluster.yml`:
    - –Ω–∞–ª–∏—á–∏–µ —Ç–∞–±–ª–∏—Ü—ã –∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Ä–µ–ø–ª–∏–∫–µ
    - –∑–∞–ø—Ä–µ—Ç –∑–∞–ø–∏—Å–∏ –Ω–∞ —Å–ª–µ–π–≤
