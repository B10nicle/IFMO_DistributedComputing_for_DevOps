## üì¶ Distributed Computing Project: Ansible + Docker + PostgreSQL + Strapi

–ü—Ä–æ–µ–∫—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ CMS Strapi –∏ PostgreSQL-–∫–ª–∞—Å—Ç–µ—Ä–∞ (–º–∞—Å—Ç–µ—Ä + —Å–ª–µ–π–≤) —Å –ø–æ–º–æ—â—å—é **Ansible**, **Docker** –∏ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ `.env`.

---

### üìå –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- Ansible 2.18+
- –ö–æ–ª–ª–µ–∫—Ü–∏—è `community.docker`

---

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
IFMO_DistributedComputing_for_DevOps/
‚îú‚îÄ‚îÄ group_vars/
‚îÇ   ‚îî‚îÄ‚îÄ all.yml            # –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞ (.env –≤ Ansible)
‚îÇ
‚îú‚îÄ‚îÄ playbooks/
‚îÇ   ‚îú‚îÄ‚îÄ docker/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ install.yml     # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ remove.yml      # –£–¥–∞–ª–µ–Ω–∏–µ Docker
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ hw1/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ install.yml     # –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ HW1 (Strapi + PostgreSQL)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ remove.yml      # –û—á–∏—Å—Ç–∫–∞ HW1
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ hw2/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ install.yml     # –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ HW2 (PostgreSQL master + replica)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ remove.yml      # –û—á–∏—Å—Ç–∫–∞ HW2
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ test.yml        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –≤ HW2
‚îÇ
‚îú‚îÄ‚îÄ roles/
‚îÇ   ‚îú‚îÄ‚îÄ pg_cluster_master/  # –†–æ–ª—å –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –º–∞—Å—Ç–µ—Ä-–±–∞–∑—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tasks/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ main.yml
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ pg_cluster_replica/ # –†–æ–ª—å –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è —Ä–µ–ø–ª–∏–∫–∏ –±–∞–∑—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tasks/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ main.yml
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ strapi/             # –†–æ–ª—å –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è Strapi
‚îÇ       ‚îî‚îÄ‚îÄ tasks/
‚îÇ           ‚îî‚îÄ‚îÄ main.yml
‚îÇ
‚îú‚îÄ‚îÄ .env                    # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ .env.example            # –ü—Ä–∏–º–µ—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è .env
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ ansible.cfg             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Ansible (–ø—É—Ç–∏ –¥–ª—è —Ä–æ–ª–µ–π –∏ –∫–æ–ª–ª–µ–∫—Ü–∏–π)
‚îú‚îÄ‚îÄ inventory.yml           # –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å Ansible
‚îú‚îÄ‚îÄ Makefile                # –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã –∑–∞–ø—É—Å–∫–∞
‚îî‚îÄ‚îÄ README.md               # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
```

---

### ‚öôÔ∏è –ü—Ä–∏–º–µ—Ä .env

```env
# SSH
VM1_HOST_IP=
VM1_SSH_USER=
VM1_SSH_PASSWORD=
VM1_SSH_KEY_PATH=

# Docker
DOCKER_UBUNTU_CODENAME=
DOCKER_ARCHITECTURE=

# PostgreSQL
PG_REPLICATION_USER=
PG_REPLICATION_PASSWORD=
PG_USERNAME=
PG_PASSWORD=
PG_DATABASE=
PG_POSTGRES_PASSWORD=
PG_NETWORK=
PG_PORT=
PG_REPLICA_CONTAINER_NAME=
PG_REPLICA_IMAGE=
PG_REPLICA_VOLUME=
PG_REPLICA_VOLUME_PATH=
PG_MASTER_CONTAINER_NAME=
PG_MASTER_IMAGE=
PG_MASTER_VOLUME=
PG_MASTER_VOLUME_PATH=

# Strapi
STRAPI_CONTAINER_NAME=
STRAPI_CHECK_DELAY=
STRAPI_CHECK_RETRIES=
STRAPI_PLATFORM=
STRAPI_IMAGE=
STRAPI_PORTS=
STRAPI_DATABASE_HOST=
STRAPI_DATABASE_CLIENT=
```

> –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `group_vars/all.yml` –¥–ª—è –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–Ω–∞—á–µ–Ω–∏–π –∏–∑ `.env`.

---

### üöÄ –ö–æ–º–∞–Ω–¥—ã Makefile

| –ö–æ–º–∞–Ω–¥–∞               | –î–µ–π—Å—Ç–≤–∏–µ                                                              |
|-----------------------|-----------------------------------------------------------------------|
| `make init`           | –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ `.env`                             |
| `make docker-install` | –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç Docker –Ω–∞ —Å–µ—Ä–≤–µ—Ä                                       |
| `make docker-remove`  | –£–¥–∞–ª—è–µ—Ç Docker, –µ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, –∫–ª—é—á–∏, –≥—Ä—É–ø–ø—ã –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏          |
| `make hw1-install`    | –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç –æ–∫—Ä—É–∂–µ–Ω–∏–µ HW1 (PostgreSQL + Strapi)                    |
| `make hw1-remove`     | –ü–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—è–µ—Ç –æ–∫—Ä—É–∂–µ–Ω–∏–µ HW1                                      |
| `make hw2-install`    | –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç –æ–∫—Ä—É–∂–µ–Ω–∏–µ HW2 (PostgreSQL –∫–ª–∞—Å—Ç–µ—Ä master + replica)    |
| `make hw2-remove`     | –ü–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—è–µ—Ç –æ–∫—Ä—É–∂–µ–Ω–∏–µ HW2                                      |
| `make hw2-test`       | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –∏ –∑–∞—â–∏—Ç—É –æ—Ç –∑–∞–ø–∏—Å–∏ –Ω–∞ —Å–ª–µ–π–≤    |
---

### ‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

- üê≥ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —É–¥–∞–ª–µ–Ω–∏–µ Docker —á–µ—Ä–µ–∑ Ansible
- üõ† –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ PostgreSQL master –∏ Strapi CMS (HW1)
- üîÅ –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞ PostgreSQL master + replica (HW2)
- üîê –í—ã–Ω–µ—Å–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–∞—Ä–æ–ª–µ–π –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ `.env`
- üì¶ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Docker volumes –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö Strapi
- üåê –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤ —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–µ Docker-—Å–µ—Ç–∏ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- üß† –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏:
  - –ù–∞–ª–∏—á–∏–µ —Ç–∞–±–ª–∏—Ü—ã –∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Ä–µ–ø–ª–∏–∫–µ
  - –ó–∞—â–∏—Ç–∞ —Å–ª–µ–π–≤–∞ –æ—Ç –∑–∞–ø–∏—Å–∏ (read-only mode)
